import{_ as g,o,c as d,a as t,f as r,g as b,F as _,h,t as l,v as f,i as m,n as x,e as u,j as v}from"./index-18e94723.js";const y={name:"create_form",components:{},data(){return{rep:{},data:{id:"",type_media:{id:""},nom:"",description:"",tags:[]},file:null,alert:"",data_ready:!1,redirect:"",end:!1,tags:[]}},methods:{async get_thes(){return await(await fetch(`${this.$url_prefix}/pedagogie/get_thes`)).json()},MaxLengthTextarea(i,e){this.data[i].length>e&&(this.data[i]=this.data[i].substring(0,e),alert("Votre texte ne doit pas dépasser "+e+" caractères!"))},handleFileUpload(i){this.file=i.target.files[0]},async send_data(){if(!this.data.id){let i=new FormData;i.append("file",this.file),i.append("type_media",this.data.type_media.id);let c=await(await fetch(`${this.$url_prefix}/medias/cr_or_up_media`,{method:"POST",body:i})).json();c.alert?this.alert=c.alert:this.data.id=c}this.data.id&&await fetch(`${this.$url_prefix}/medias/cr_or_up_media`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.data)}).then(i=>{i.text().then(e=>{this.redirect=e,this.end=!0})})},update_tags(){for(let i in this.data.tags)this.data.tags[i]={id:this.data.tags[i]}},async get_media(i){return await(await fetch(`${this.$url_prefix}/medias/get_media?q=${i}`)).json()}},computed:{nvl(){return this.data.nom.length},dvl(){return this.data.description.length},iscomplete(){return this.data.id?this.data.type_media.id&&this.data.nom&&this.data.description&&this.data.tags.length!=0:this.data.type_media.id&&this.data.nom&&this.data.description&&this.data.tags.length!=0&&this.file},issend(){return this.end},isalert(){return this.alert?"is-active":""},isfile(){return!this.data.id}},watch:{tags:function(i){this.data.tags=[];for(let e in i)this.data.tags.push(i[e]);this.update_tags()}},async mounted(){if(this.rep=await this.get_thes(),this.$route.query.q){this.data=await this.get_media(this.$route.query.q);for(let i in this.data.tags)this.tags.push(this.data.tags[i].id)}this.data_ready=!0}},k={key:0},w={key:0},V={class:"container large_form bottom_120"},C={class:"form_position"},T=t("h1",{class:"subtitle text_color"},"Importer un nouveau média",-1),q=t("p",{class:"text_color"},"Les champs marqués d'un astérisque (*) sont obligatoires.",-1),M={class:"box"},j={class:"field"},L=t("label",{class:"label"},"Type de média*",-1),N={class:"control"},U={class:"select"},S=t("option",{value:""},"Choisir ...",-1),D=["value"],F={class:"form_position"},z=t("label",{class:"label"},"Mots-clés*",-1),B={class:"columns is-gapless is-multiline"},E={class:"column is-2"},O=["for"],K=["value","id"],P={class:"column is-2"},R=["for"],A=["value","id"],I=t("div",{class:"block"},null,-1),J={class:"field"},G=t("label",{class:"label"},"Nom du media*",-1),H={class:"control"},Q={class:"field"},W=t("label",{class:"label"},"Description du media*",-1),X={class:"control"},Y={key:0,class:"field"},Z=t("label",{class:"label"},"Selection du media*",-1),$={class:"control"},tt={class:"buttons spaced_buttons"},et=t("i",null,null,-1),st=t("div",{class:"modal-background"},null,-1),it={class:"modal-content"},at={class:"box"},ot={key:0},dt=t("p",{class:"subtitle text_center"},"Média déjà existant",-1),nt=t("p",null,"Le média que vous avez essayé d'importer existe déja !",-1),lt=[dt,nt],rt={key:1},ct=t("p",{class:"subtitle text_center"},"Extension non supportée",-1),_t=t("p",null,"Les extensions supportés sont :",-1),ht={class:"columns is-multiline"},ut={class:"column is-1"},pt={key:1,class:"container form_position"},mt={class:"title"},ft=["href"];function vt(i,e,c,gt,a,n){return a.data_ready?(o(),d("div",k,[n.issend?(o(),d("div",pt,[t("h1",mt,[u("Vous pouvez rechercher "),t("a",{href:a.redirect},"votre média",8,ft),u(" !")])])):(o(),d("div",w,[t("div",V,[t("div",C,[T,q,t("div",M,[t("div",j,[L,t("div",N,[t("div",U,[r(t("select",{name:"type_media","onUpdate:modelValue":e[0]||(e[0]=s=>a.data.type_media.id=s)},[S,(o(!0),d(_,null,h(a.rep["ref.type_media"],s=>(o(),d("option",{value:s.id},l(s.label),9,D))),256))],512),[[b,a.data.type_media.id]])])])]),t("div",F,[z,t("div",B,[(o(!0),d(_,null,h(a.rep["ref.theme"],s=>(o(),d("div",E,[t("label",{class:"checkbox",for:s.id},[r(t("input",{type:"checkbox",value:s.id,name:"theme",id:s.id,"onUpdate:modelValue":e[1]||(e[1]=p=>a.tags=p)},null,8,K),[[v,a.tags]]),u(" "+l(s.label),1)],8,O)]))),256)),(o(!0),d(_,null,h(a.rep["ref.saison"],s=>(o(),d("div",P,[t("label",{class:"checkbox",for:s.id},[r(t("input",{type:"checkbox",value:s.id,name:"saison",id:s.id,"onUpdate:modelValue":e[2]||(e[2]=p=>a.tags=p)},null,8,A),[[v,a.tags]]),u(" "+l(s.label),1)],8,R)]))),256))]),I]),t("div",J,[G,t("div",H,[t("span",null,"Nombre de caractères : "+l(n.nvl),1),r(t("textarea",{class:"textarea",rows:"2",placeholder:"Rentrer le texte en moins de 60 caractères.",name:"nom","onUpdate:modelValue":e[3]||(e[3]=s=>a.data.nom=s),onKeyup:e[4]||(e[4]=s=>{n.MaxLengthTextarea("nom",60)})},null,544),[[f,a.data.nom]])])]),t("div",Q,[W,t("div",X,[t("span",null,"Nombre de caractères : "+l(n.dvl),1),r(t("textarea",{class:"textarea",rows:"3",placeholder:"Rentrer le texte en moins de 200 caractères.",name:"description","onUpdate:modelValue":e[5]||(e[5]=s=>a.data.description=s),onKeyup:e[6]||(e[6]=s=>{n.MaxLengthTextarea("description",200)})},null,544),[[f,a.data.description]])])]),n.isfile?(o(),d("div",Y,[Z,t("div",$,[t("input",{type:"file",name:"file",onChange:e[7]||(e[7]=s=>n.handleFileUpload(s))},null,32)])])):m("",!0),t("div",tt,[et,n.iscomplete?(o(),d("button",{key:0,class:"button",onClick:e[8]||(e[8]=s=>n.send_data())},"Enregistrer")):m("",!0)])]),t("div",{class:x(["modal",n.isalert])},[st,t("div",it,[t("div",at,[a.alert=="duplicate"?(o(),d("div",ot,lt)):(o(),d("div",rt,[ct,_t,t("div",ht,[(o(!0),d(_,null,h(a.alert,s=>(o(),d("div",ut,l(s),1))),256))])])),t("button",{id:"modal_button",class:"button is-primary",onClick:e[9]||(e[9]=s=>a.alert="")},"Accepter")])])],2)])])]))])):m("",!0)}const xt=g(y,[["render",vt]]);export{xt as default};
