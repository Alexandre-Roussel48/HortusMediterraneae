import{_ as k,r as x,o,c as n,a as s,t as h,F as m,h as y,b as r,i as p,n as $,e as b,d as w,f,j as v}from"./index-04d57ed5.js";const q={name:"medias",props:["key","query","types"],data(){return{rep:[],medias:[],pertinence:[],medias_ready:!1}},methods:{async get_medias(){let e="";for(let a in this.query)e+=`&tag=${this.query[a]}`;for(let a in this.types)e+=`&type=${this.types[a]}`;return e=e.replace("&",""),await(await fetch(`${this.$url_prefix}/medias/results?${e}`)).json()},toggle_media(e){e.open==""?e.open="is-active":e.open=""},get_url(e){return`${this.$url_prefix}/`+e.url},download_media(e){fetch(`${this.$url_prefix}/medias/download?q=${e.id}`).then(l=>l.blob()).then(l=>URL.createObjectURL(l)).then(l=>{var a=document.createElement("a");a.href=l,a.download=e.nom+e.url.substring(e.url.indexOf(".")),document.body.appendChild(a),a.click(),document.body.removeChild(a)})},async delete_media(e){await fetch(`${this.$url_prefix}/medias/delete?q=${e.id}`),this.$emit("update")}},computed:{},async mounted(){this.rep=await this.get_medias();for(let e in this.rep)this.medias.push(this.rep[e][0]),this.pertinence.push(this.rep[e][1]);this.medias_ready=!0}},C={key:0},V={class:"container large_form bottom_120"},M={class:"form_position"},U={class:"subtitle is-6 text_color"},j={class:"box"},B={class:"form_position"},L={class:"box"},F={class:"columns text_break"},N={class:"column is-1"},O={key:0,class:"tooltip"},R={class:"icon"},T=s("span",{class:"tooltiptext"},"Image",-1),D={key:1,class:"tooltip"},E={class:"icon"},H=s("span",{class:"tooltiptext"},"Photo",-1),P={key:2,class:"tooltip"},S={class:"icon"},z=s("span",{class:"tooltiptext"},"Vidéo",-1),A={key:3,class:"tooltip"},I={class:"icon"},G=s("span",{class:"tooltiptext"},"Bande-son",-1),J={key:4,class:"tooltip"},K={class:"icon"},Q=s("span",{class:"tooltiptext"},"Fichier",-1),W={key:5,class:"tooltip"},X={class:"icon"},Y=s("span",{class:"tooltiptext"},"Conte",-1),Z={class:"column is-1"},ss={class:"column is-3"},es=["innerHTML"],ts={class:"column is-2"},os=["onClick"],ns=s("div",{class:"modal-background"},null,-1),is={class:"modal-content large_modal"},cs={class:"box"},ls={class:"subtitle"},_s={key:0,controls:"",class:"embeb_position"},as=["src"],ds={key:1,controls:"",class:"embeb_position"},rs=["src"],us=["src"],hs={class:"buttons spaced_buttons"},ps=s("i",null,null,-1),ms=["onClick"],ys={class:"field has-addons"},fs={class:"control"},vs=["onClick"],bs={class:"icon"},ks={class:"control"},xs=["href"],gs={class:"icon"},$s={class:"control"},ws=["onClick"],qs={class:"icon"},Cs={class:"column is-4"},Vs=s("b",null,"Mots-clés :",-1),Ms={class:"columns is-multiline"},Us={class:"column is-6"},js={class:"icon-text"},Bs={class:"icon"},Ls={key:0,class:"column is-1"};function Fs(e,l,a,g,i,u){const _=x("font-awesome-icon");return i.medias_ready?(o(),n("div",C,[s("div",V,[s("div",M,[s("p",U,h(i.medias.length)+" résultat(s)",1),s("div",j,[(o(!0),n(m,null,y(i.medias,(t,c)=>(o(),n("div",B,[s("div",L,[s("div",F,[s("div",N,[t.type_media.code=="image"?(o(),n("div",O,[s("span",R,[r(_,{icon:["fas","image"]})]),T])):t.type_media.code=="photo"?(o(),n("div",D,[s("span",E,[r(_,{icon:["fas","camera"]})]),H])):t.type_media.code=="video"?(o(),n("div",P,[s("span",S,[r(_,{icon:["fas","video"]})]),z])):t.type_media.code=="bandeson"?(o(),n("div",A,[s("span",I,[r(_,{icon:["fas","headphones"]})]),G])):t.type_media.code=="support"?(o(),n("div",J,[s("span",K,[r(_,{icon:["fas","file"]})]),Q])):t.type_media.code=="conte"?(o(),n("div",W,[s("span",X,[r(_,{icon:["fas","book"]})]),Y])):p("",!0)]),s("div",Z,h(t.nom),1),s("div",ss,[s("div",{innerHTML:e.md(t.description)},null,8,es)]),s("div",ts,[s("button",{class:"button",onClick:d=>u.toggle_media(t)},"Aperçu",8,os),s("div",{class:$(["modal",t.open])},[ns,s("div",is,[s("div",cs,[s("h1",ls,h(t.nom),1),t.type_media.code=="video"?(o(),n("video",_s,[s("source",{src:u.get_url(t)},null,8,as),b(" Votre navigateur ne supporte pas cette extension. ")])):t.type_media.code=="bandeson"?(o(),n("audio",ds,[s("source",{src:u.get_url(t)},null,8,rs),b(" Votre navigateur ne supporte pas cette extension. ")])):(o(),n("embed",{key:2,src:u.get_url(t),class:"embeb_position"},null,8,us)),s("div",hs,[ps,s("button",{class:"button",onClick:d=>u.toggle_media(t)},"Fermer",8,ms)])])])],2),s("div",ys,[s("p",fs,[s("a",{onClick:d=>u.download_media(t),class:"button"},[s("span",bs,[r(_,{icon:["fas","download"]})])],8,vs)]),s("p",ks,[s("a",{href:"/medias/create?q="+t.id,class:"button"},[s("span",gs,[r(_,{icon:["fas","pen"]})])],8,xs)]),s("p",$s,[s("a",{onClick:d=>u.delete_media(t),class:"button"},[s("span",qs,[r(_,{icon:["fas","trash"]})])],8,ws)])])]),s("div",Cs,[Vs,s("div",Ms,[(o(!0),n(m,null,y(t.tags,d=>(o(),n("div",Us,[s("span",js,[s("span",Bs,[r(_,{icon:["fas","check"]})]),s("span",null,h(d.label),1)])]))),256))])]),i.pertinence[c]?(o(),n("div",Ls," Pertinence : "+h(i.pertinence[c]),1)):p("",!0)])])]))),256))])])])])):p("",!0)}const Ns=k(q,[["render",Fs]]),Os={name:"search_form",components:{Medias:Ns},data(){return{tags:[],data_ready:!1,types:[],query:[],key:0}},methods:{async get_tags(){return await(await fetch(`${this.$url_prefix}/medias/get_tags_search`)).json()},update_on_delete(){this.key++}},watch:{types:function(){this.key++},query:function(){this.key++}},async mounted(){this.tags=await this.get_tags(),this.data_ready=!0}},Rs={key:0},Ts={class:"container large_form"},Ds={class:"form_position"},Es=s("h1",{class:"subtitle text_color"},"Rechercher une animation",-1),Hs={class:"box"},Ps=s("p",{class:"subtitle"},"Mots-clés*",-1),Ss={class:"form_position"},zs={class:"subtitle is-6"},As={class:"columns is-gapless is-multiline"},Is={class:"column is-2"},Gs=["for"],Js=["value","name","id"],Ks=["value","name","id"],Qs=["value","name","id"];function Ws(e,l,a,g,i,u){const _=x("Medias");return i.data_ready?(o(),n("div",Rs,[s("div",Ts,[s("div",Ds,[Es,s("div",Hs,[Ps,(o(!0),n(m,null,y(Object.keys(i.tags),t=>(o(),n("div",Ss,[s("p",zs,h(t),1),s("div",As,[(o(!0),n(m,null,y(i.tags[t],c=>(o(),n("div",Is,[s("label",{for:c.id},[c.reference=="ref.theme"?f((o(),n("input",{key:0,type:"checkbox",value:c.id,name:c.code,id:c.id,"onUpdate:modelValue":l[0]||(l[0]=d=>i.query=d)},null,8,Js)),[[v,i.query]]):p("",!0),c.reference=="ref.saison"?f((o(),n("input",{key:1,type:"checkbox",value:c.id,name:c.code,id:c.id,"onUpdate:modelValue":l[1]||(l[1]=d=>i.query=d)},null,8,Ks)),[[v,i.query]]):p("",!0),c.reference=="ref.type_media"?f((o(),n("input",{key:2,type:"checkbox",value:c.id,name:c.code,id:c.id,"onUpdate:modelValue":l[2]||(l[2]=d=>i.types=d)},null,8,Qs)),[[v,i.types]]):p("",!0),b(" "+h(c.label),1)],8,Gs)]))),256))])]))),256))])])]),(o(),w(_,{key:i.key,query:i.query,types:i.types,onUpdate:l[3]||(l[3]=t=>u.update_on_delete())},null,8,["query","types"]))])):p("",!0)}const Ys=k(Os,[["render",Ws]]);export{Ys as default};
