import{_ as b,r as x,o,c as d,a as t,f as r,g as y,F as h,h as u,t as l,v as f,i as m,n as k,e as c,b as w,w as V,j as v}from"./index-4760c962.js";const C={name:"create_form",components:{},data(){return{rep:{},data:{id:"",type_media:{id:""},nom:"",description:"",tags:[]},file:null,alert:"",data_ready:!1,redirect:"",end:!1,tags:[]}},methods:{async get_thes(){return await(await fetch(`${this.$url_prefix}/pedagogie/get_thes`)).json()},MaxLengthTextarea(i,e){this.data[i].length>e&&(this.data[i]=this.data[i].substring(0,e),alert("Votre texte ne doit pas dépasser "+e+" caractères!"))},handleFileUpload(i){this.file=i.target.files[0]},async send_data(){if(!this.data.id){let i=new FormData;i.append("file",this.file),i.append("type_media",this.data.type_media.id);let _=await(await fetch(`${this.$url_prefix}/medias/cr_or_up_media`,{method:"POST",body:i})).json();_.alert?this.alert=_.alert:this.data.id=_}this.data.id&&await fetch(`${this.$url_prefix}/medias/cr_or_up_media`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.data)}).then(i=>{i.text().then(e=>{this.redirect=e,this.end=!0})})},update_tags(){for(let i in this.data.tags)this.data.tags[i]={id:this.data.tags[i]}},async get_media(i){return await(await fetch(`${this.$url_prefix}/medias/get_media?q=${i}`)).json()}},computed:{nvl(){return this.data.nom.length},dvl(){return this.data.description.length},iscomplete(){return this.data.id?this.data.type_media.id&&this.data.nom&&this.data.description&&this.data.tags.length!=0:this.data.type_media.id&&this.data.nom&&this.data.description&&this.data.tags.length!=0&&this.file},issend(){return this.end},isalert(){return this.alert?"is-active":""},isfile(){return!this.data.id}},watch:{tags:function(i){this.data.tags=[];for(let e in i)this.data.tags.push(i[e]);this.update_tags()}},async mounted(){if(this.rep=await this.get_thes(),this.$route.query.q){this.data=await this.get_media(this.$route.query.q);for(let i in this.data.tags)this.tags.push(this.data.tags[i].id)}this.data_ready=!0}},L={key:0},T={key:0},q={class:"container large_form bottom_120"},M={class:"form_position"},N=t("h1",{class:"subtitle text_color"},"Importer un nouveau média",-1),j=t("p",{class:"text_color"},"Les champs marqués d'un astérisque (*) sont obligatoires.",-1),U={class:"box"},S={class:"field"},D=t("label",{class:"label"},"Type de média*",-1),F={class:"control"},R={class:"select"},z=t("option",{value:""},"Choisir ...",-1),B=["value"],E={class:"form_position"},O=t("label",{class:"label"},"Mots-clés*",-1),K={class:"columns is-gapless is-multiline"},P={class:"column is-2"},A=["for"],I=["value","id"],J={class:"column is-2"},G=["for"],H=["value","id"],Q=t("div",{class:"block"},null,-1),W={class:"field"},X=t("label",{class:"label"},"Nom du media*",-1),Y={class:"control"},Z={class:"field"},$=t("label",{class:"label"},"Description du media*",-1),tt={class:"control"},et={key:0,class:"field"},st=t("label",{class:"label"},"Selection du media*",-1),it={class:"control"},at={class:"buttons spaced_buttons"},ot=t("i",null,null,-1),dt=t("div",{class:"modal-background"},null,-1),nt={class:"modal-content"},lt={class:"box"},rt={key:0},ct=t("p",{class:"subtitle text_center"},"Média déjà existant",-1),_t=t("p",null,"Le média que vous avez essayé d'importer existe déja !",-1),ht=[ct,_t],ut={key:1},pt=t("p",{class:"subtitle text_center"},"Extension non supportée",-1),mt=t("p",null,"Les extensions supportés sont :",-1),ft={class:"columns is-multiline"},vt={class:"column is-1"},gt={key:1,class:"container form_position"},bt={class:"title"};function xt(i,e,_,yt,a,n){const g=x("RouterLink");return a.data_ready?(o(),d("div",L,[n.issend?(o(),d("div",gt,[t("h1",bt,[c("Vous pouvez rechercher "),w(g,{to:a.redirect},{default:V(()=>[c("votre média")]),_:1},8,["to"]),c(" !")])])):(o(),d("div",T,[t("div",q,[t("div",M,[N,j,t("div",U,[t("div",S,[D,t("div",F,[t("div",R,[r(t("select",{name:"type_media","onUpdate:modelValue":e[0]||(e[0]=s=>a.data.type_media.id=s)},[z,(o(!0),d(h,null,u(a.rep["ref.type_media"],s=>(o(),d("option",{value:s.id},l(s.label),9,B))),256))],512),[[y,a.data.type_media.id]])])])]),t("div",E,[O,t("div",K,[(o(!0),d(h,null,u(a.rep["ref.theme"],s=>(o(),d("div",P,[t("label",{class:"checkbox",for:s.id},[r(t("input",{type:"checkbox",value:s.id,name:"theme",id:s.id,"onUpdate:modelValue":e[1]||(e[1]=p=>a.tags=p)},null,8,I),[[v,a.tags]]),c(" "+l(s.label),1)],8,A)]))),256)),(o(!0),d(h,null,u(a.rep["ref.saison"],s=>(o(),d("div",J,[t("label",{class:"checkbox",for:s.id},[r(t("input",{type:"checkbox",value:s.id,name:"saison",id:s.id,"onUpdate:modelValue":e[2]||(e[2]=p=>a.tags=p)},null,8,H),[[v,a.tags]]),c(" "+l(s.label),1)],8,G)]))),256))]),Q]),t("div",W,[X,t("div",Y,[t("span",null,"Nombre de caractères : "+l(n.nvl),1),r(t("textarea",{class:"textarea",rows:"2",placeholder:"Rentrer le texte en moins de 60 caractères.",name:"nom","onUpdate:modelValue":e[3]||(e[3]=s=>a.data.nom=s),onKeyup:e[4]||(e[4]=s=>{n.MaxLengthTextarea("nom",60)})},null,544),[[f,a.data.nom]])])]),t("div",Z,[$,t("div",tt,[t("span",null,"Nombre de caractères : "+l(n.dvl),1),r(t("textarea",{class:"textarea",rows:"3",placeholder:"Rentrer le texte en moins de 200 caractères.",name:"description","onUpdate:modelValue":e[5]||(e[5]=s=>a.data.description=s),onKeyup:e[6]||(e[6]=s=>{n.MaxLengthTextarea("description",200)})},null,544),[[f,a.data.description]])])]),n.isfile?(o(),d("div",et,[st,t("div",it,[t("input",{type:"file",name:"file",onChange:e[7]||(e[7]=s=>n.handleFileUpload(s))},null,32)])])):m("",!0),t("div",at,[ot,n.iscomplete?(o(),d("button",{key:0,class:"button",onClick:e[8]||(e[8]=s=>n.send_data())},"Enregistrer")):m("",!0)])]),t("div",{class:k(["modal",n.isalert])},[dt,t("div",nt,[t("div",lt,[a.alert=="duplicate"?(o(),d("div",rt,ht)):(o(),d("div",ut,[pt,mt,t("div",ft,[(o(!0),d(h,null,u(a.alert,s=>(o(),d("div",vt,l(s),1))),256))])])),t("button",{id:"modal_button",class:"button is-primary",onClick:e[9]||(e[9]=s=>a.alert="")},"Accepter")])])],2)])])]))])):m("",!0)}const wt=b(C,[["render",xt]]);export{wt as default};
