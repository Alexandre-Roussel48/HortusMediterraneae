import{_ as g,r as k,o,c as n,a as s,t as u,F as y,h as f,b as a,i as p,n as w,e as x,w as q,d as C,f as v,j as b}from"./index-aa26a53f.js";const V={name:"medias",props:["key","query","types"],data(){return{rep:[],medias:[],pertinence:[],medias_ready:!1}},methods:{async get_medias(){let t="";for(let _ in this.query)t+=`&tag=${this.query[_]}`;for(let _ in this.types)t+=`&type=${this.types[_]}`;return t=t.replace("&",""),await(await fetch(`${this.$url_prefix}/medias/results?${t}`)).json()},toggle_media(t){t.open==""?t.open="is-active":t.open=""},get_url(t){return`${this.$url_prefix}/`+t.url},download_media(t){fetch(`${this.$url_prefix}/medias/download?q=${t.id}`).then(c=>c.blob()).then(c=>URL.createObjectURL(c)).then(c=>{var _=document.createElement("a");_.href=c,_.download=t.nom+t.url.substring(t.url.indexOf(".")),document.body.appendChild(_),_.click(),document.body.removeChild(_)})},async delete_media(t){await fetch(`${this.$url_prefix}/medias/delete?q=${t.id}`),this.$emit("update")}},computed:{},async mounted(){this.rep=await this.get_medias();for(let t in this.rep)this.medias.push(this.rep[t][0]),this.pertinence.push(this.rep[t][1]);this.medias_ready=!0}},M={key:0},L={class:"container large_form bottom_120"},U={class:"form_position"},j={class:"subtitle is-6 text_color"},B={class:"box"},R={class:"form_position"},F={class:"box"},N={class:"columns text_break"},O={class:"column is-1"},T={key:0,class:"tooltip"},D={class:"icon"},E=s("span",{class:"tooltiptext"},"Image",-1),H={key:1,class:"tooltip"},P={class:"icon"},S=s("span",{class:"tooltiptext"},"Photo",-1),z={key:2,class:"tooltip"},A={class:"icon"},I=s("span",{class:"tooltiptext"},"Vidéo",-1),G={key:3,class:"tooltip"},J={class:"icon"},K=s("span",{class:"tooltiptext"},"Bande-son",-1),Q={key:4,class:"tooltip"},W={class:"icon"},X=s("span",{class:"tooltiptext"},"Fichier",-1),Y={key:5,class:"tooltip"},Z={class:"icon"},ss=s("span",{class:"tooltiptext"},"Conte",-1),es={class:"column is-1"},ts={class:"column is-3"},os=["innerHTML"],ns={class:"column is-2"},is=["onClick"],cs=s("div",{class:"modal-background"},null,-1),ls={class:"modal-content large_modal"},_s={class:"box"},as={class:"subtitle"},ds={key:0,controls:"",class:"embeb_position"},rs=["src"],us={key:1,controls:"",class:"embeb_position"},ps=["src"],hs=["src"],ms={class:"buttons spaced_buttons"},ys=s("i",null,null,-1),fs=["onClick"],vs={class:"field has-addons"},bs={class:"control"},ks=["onClick"],xs={class:"icon"},gs={class:"control"},$s={class:"icon"},ws={class:"control"},qs=["onClick"],Cs={class:"icon"},Vs={class:"column is-4"},Ms=s("b",null,"Mots-clés :",-1),Ls={class:"columns is-multiline"},Us={class:"column is-6"},js={class:"icon-text"},Bs={class:"icon"},Rs={key:0,class:"column is-1"};function Fs(t,c,_,$,i,d){const l=k("font-awesome-icon"),h=k("RouterLink");return i.medias_ready?(o(),n("div",M,[s("div",L,[s("div",U,[s("p",j,u(i.medias.length)+" résultat(s)",1),s("div",B,[(o(!0),n(y,null,f(i.medias,(e,r)=>(o(),n("div",R,[s("div",F,[s("div",N,[s("div",O,[e.type_media.code=="image"?(o(),n("div",T,[s("span",D,[a(l,{icon:["fas","image"]})]),E])):e.type_media.code=="photo"?(o(),n("div",H,[s("span",P,[a(l,{icon:["fas","camera"]})]),S])):e.type_media.code=="video"?(o(),n("div",z,[s("span",A,[a(l,{icon:["fas","video"]})]),I])):e.type_media.code=="bandeson"?(o(),n("div",G,[s("span",J,[a(l,{icon:["fas","headphones"]})]),K])):e.type_media.code=="support"?(o(),n("div",Q,[s("span",W,[a(l,{icon:["fas","file"]})]),X])):e.type_media.code=="conte"?(o(),n("div",Y,[s("span",Z,[a(l,{icon:["fas","book"]})]),ss])):p("",!0)]),s("div",es,u(e.nom),1),s("div",ts,[s("div",{innerHTML:t.md(e.description)},null,8,os)]),s("div",ns,[s("button",{class:"button",onClick:m=>d.toggle_media(e)},"Aperçu",8,is),s("div",{class:w(["modal",e.open])},[cs,s("div",ls,[s("div",_s,[s("h1",as,u(e.nom),1),e.type_media.code=="video"?(o(),n("video",ds,[s("source",{src:d.get_url(e)},null,8,rs),x(" Votre navigateur ne supporte pas cette extension. ")])):e.type_media.code=="bandeson"?(o(),n("audio",us,[s("source",{src:d.get_url(e)},null,8,ps),x(" Votre navigateur ne supporte pas cette extension. ")])):(o(),n("embed",{key:2,src:d.get_url(e),class:"embeb_position"},null,8,hs)),s("div",ms,[ys,s("button",{class:"button",onClick:m=>d.toggle_media(e)},"Fermer",8,fs)])])])],2),s("div",vs,[s("p",bs,[s("a",{onClick:m=>d.download_media(e),class:"button"},[s("span",xs,[a(l,{icon:["fas","download"]})])],8,ks)]),s("p",gs,[a(h,{to:"/medias/create?q="+e.id,class:"button"},{default:q(()=>[s("span",$s,[a(l,{icon:["fas","pen"]})])]),_:2},1032,["to"])]),s("p",ws,[s("a",{onClick:m=>d.delete_media(e),class:"button"},[s("span",Cs,[a(l,{icon:["fas","trash"]})])],8,qs)])])]),s("div",Vs,[Ms,s("div",Ls,[(o(!0),n(y,null,f(e.tags,m=>(o(),n("div",Us,[s("span",js,[s("span",Bs,[a(l,{icon:["fas","check"]})]),s("span",null,u(m.label),1)])]))),256))])]),i.pertinence[r]?(o(),n("div",Rs," Pertinence : "+u(i.pertinence[r]),1)):p("",!0)])])]))),256))])])])])):p("",!0)}const Ns=g(V,[["render",Fs]]),Os={name:"search_form",components:{Medias:Ns},data(){return{tags:[],data_ready:!1,types:[],query:[],key:0}},methods:{async get_tags(){return await(await fetch(`${this.$url_prefix}/medias/get_tags_search`)).json()},update_on_delete(){this.key++}},watch:{types:function(){this.key++},query:function(){this.key++}},async mounted(){this.tags=await this.get_tags(),this.data_ready=!0}},Ts={key:0},Ds={class:"container large_form"},Es={class:"form_position"},Hs=s("h1",{class:"subtitle text_color"},"Rechercher une animation",-1),Ps={class:"box"},Ss=s("p",{class:"subtitle"},"Mots-clés*",-1),zs={class:"form_position"},As={class:"subtitle is-6"},Is={class:"columns is-gapless is-multiline"},Gs={class:"column is-2"},Js=["for"],Ks=["value","name","id"],Qs=["value","name","id"],Ws=["value","name","id"];function Xs(t,c,_,$,i,d){const l=k("Medias");return i.data_ready?(o(),n("div",Ts,[s("div",Ds,[s("div",Es,[Hs,s("div",Ps,[Ss,(o(!0),n(y,null,f(Object.keys(i.tags),h=>(o(),n("div",zs,[s("p",As,u(h),1),s("div",Is,[(o(!0),n(y,null,f(i.tags[h],e=>(o(),n("div",Gs,[s("label",{for:e.id},[e.reference=="ref.theme"?v((o(),n("input",{key:0,type:"checkbox",value:e.id,name:e.code,id:e.id,"onUpdate:modelValue":c[0]||(c[0]=r=>i.query=r)},null,8,Ks)),[[b,i.query]]):p("",!0),e.reference=="ref.saison"?v((o(),n("input",{key:1,type:"checkbox",value:e.id,name:e.code,id:e.id,"onUpdate:modelValue":c[1]||(c[1]=r=>i.query=r)},null,8,Qs)),[[b,i.query]]):p("",!0),e.reference=="ref.type_media"?v((o(),n("input",{key:2,type:"checkbox",value:e.id,name:e.code,id:e.id,"onUpdate:modelValue":c[2]||(c[2]=r=>i.types=r)},null,8,Ws)),[[b,i.types]]):p("",!0),x(" "+u(e.label),1)],8,Js)]))),256))])]))),256))])])]),(o(),C(l,{key:i.key,query:i.query,types:i.types,onUpdate:c[3]||(c[3]=h=>d.update_on_delete())},null,8,["query","types"]))])):p("",!0)}const Zs=g(Os,[["render",Xs]]);export{Zs as default};
